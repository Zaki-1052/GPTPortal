<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chat with GPT-4</title>
  <meta name="author" content="Zakir Alibhai">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="chat.css">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify/dist/purify.min.js"></script>
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap" rel="stylesheet">
</head>
<body>
<div>
  <div id="toggleArrow">&#x25B6;</div>
  <div id="sidebar">
    <div id="chatList"></div>
    <div id="summariesButtonContainer">
      <button id="summariesButton">Summaries Only</button>
    </div>
  </div>
  <div id="promptBar">
    <div id="promptList"></div>
    <button id="copyPromptButton"></button>
 </div>
 <div id="toggleRightArrow">&#x25C0;</div>
 <div id="custom-tooltip"></div>
  
  <!-- Model Selector - Maintaining Original Look -->
  <div id="model-selector-container">
    <div class="custom-select" id="selected-model">Select a Model</div>
    <div id="model-search-container">
      <input type="text" id="model-search" placeholder="Search models...">
      <div class="toggle-container">
        <label class="toggle-switch">
          <input type="checkbox" id="show-open-router">
          <span class="toggle-slider"></span>
        </label>
        <span class="toggle-label">Show OpenRouter</span>
      </div>
    </div>
    <div id="model-options" class="select-options">
        <!-- Core models (always available) -->
        <button id="model-gpt-4o" data-value="gpt-4o" class="standard-model">GPT-4o: Latest</button>
        <button id="model-gpt-4o-mini" data-value="gpt-4o-mini" class="standard-model">GPT-4o Mini: Cheapest</button>
        <button id="model-gpt-4-turbo" data-value="gpt-4-turbo" class="standard-model">GPT-4-Turbo: Standard</button>
        <button id="model-gpt-4" data-value="gpt-4" class="standard-model">GPT-4: Original</button>
        <button id="model-gpt-3.5" data-value="gpt-3.5-turbo-0125" class="standard-model">GPT-3.5-Turbo: Old</button>
        
        <button id="model-claude-4-opus" data-value="claude-opus-4-20250514" class="standard-model">Claude 4 Opus</button>
        <button id="model-claude-4-sonnet" data-value="claude-sonnet-4-20250514" class="standard-model">Claude 4 Sonnet</button>
        <button id="model-claude-3.7-sonnet" data-value="claude-3-7-sonnet-latest" class="standard-model">Claude 3.7 Sonnet</button>
        <button id="model-claude-3.5-sonnet" data-value="claude-3-5-sonnet-latest" class="standard-model">Claude 3.5 Sonnet</button>
        <button id="model-claude-3.5-haiku" data-value="claude-3-5-haiku-latest" class="standard-model">Claude 3.5 Haiku</button>
        <button id="model-claude-haiku" data-value="claude-3-haiku-20240307" class="standard-model">Claude Haiku: Cheap</button>
        
        <button id="model-o1-preview" data-value="o1-preview" class="standard-model">GPT-o1-Preview: Reasoning</button>
        <button id="model-o1-mini" data-value="o1-mini" class="standard-model">GPT-o1 Mini: Cheap Reasoning</button>
        <button id="model-o3-mini" data-value="o3-mini" class="standard-model">GPT-o3 Mini: Cheap Reasoning</button>
        
        <button id="model-gemini-2.0-flash" data-value="gemini-2.0-flash-exp" class="standard-model">Gemini-2.0 Flash</button>
        <button id="model-gemini-1.5-pro" data-value="gemini-1.5-pro" class="standard-model">Gemini-1.5 Pro: Best</button>
        <button id="model-gemini-1.5-flash" data-value="gemini-1.5-flash" class="standard-model">Gemini-1.5 Flash</button>
        <button id="model-gemini-pro" data-value="gemini-pro" class="standard-model">Gemini Pro</button>
        
        <button id="model-deepseek-r1" data-value="deepseek-reasoner" class="standard-model">DeepSeek-R1</button>
        <button id="model-deepseek-chat" data-value="deepseek-chat" class="standard-model">DeepSeek-Chat</button>
        
        <button id="model-llama-3.1-405b" data-value="llama-3.1-405b-reasoning" class="standard-model">Llama3.1 405b</button>
        <button id="model-llama-3.1-70b" data-value="llama-3.1-70b-versatile" class="standard-model">Llama3.1 70b</button>
        <button id="model-llama-3.1-8b" data-value="llama-3.1-8b-instant" class="standard-model">Llama3.1 8b</button>
        
        <button id="model-mistral-large" data-value="mistral-large-latest" class="standard-model">Mistral Large</button>
        <button id="model-codestral" data-value="codestral-latest" class="standard-model">Codestral</button>
        
        <!-- OpenRouter models will be populated dynamically here -->
        <div id="openrouter-models-container" style="display: none;">
          <!-- Dynamic OpenRouter models will be inserted here -->
        </div>
    </div>
  </div>

  <!-- Original Chat Interface -->
  <div id="chat-interface">
    <div id="chat-container">
      <!-- Chat messages will appear here -->
    </div>
    
    <div id="input-container">
      <div id="file-preview-container"></div>
      <textarea id="message-input" placeholder="Type your message here..." rows="4"></textarea>
      <div id="input-buttons">
        <button id="attach-file-btn">ðŸ“Ž</button>
        <button id="voice-btn">ðŸŽ¤</button>
        <button id="send-btn">Send</button>
      </div>
      <input type="file" id="file-input" multiple style="display: none;">
    </div>
  </div>
</div>

<!-- Load original script.js for full functionality -->
<script src="script.js"></script>

<!-- Enhanced model management with backward compatibility -->
<script>
// Enhanced model management that works with the new API but maintains original functionality
class EnhancedModelManager {
  constructor() {
    this.openRouterModels = [];
    this.isLoading = false;
    this.init();
  }
  
  async init() {
    // Load OpenRouter models in background
    this.loadOpenRouterModels();
    
    // Set up event handlers
    this.setupEventHandlers();
    
    // Initialize with default model
    this.setDefaultModel();
  }
  
  setDefaultModel() {
    // Use the original default model logic
    if (typeof setDefaultModel === 'function') {
      setDefaultModel();
    } else {
      // Fallback
      const selectedModelDiv = document.getElementById("selected-model");
      if (selectedModelDiv && selectedModelDiv.textContent.trim() === "Select a Model") {
        selectedModelDiv.textContent = "GPT-4o: Latest";
        if (typeof currentModelID !== 'undefined') {
          currentModelID = 'gpt-4o';
        }
      }
    }
  }
  
  async loadOpenRouterModels() {
    if (this.isLoading) return;
    this.isLoading = true;
    
    try {
      console.log('Loading OpenRouter models...');
      const response = await fetch('/api/models/openrouter');
      
      if (response.ok) {
        const data = await response.json();
        if (data.success) {
          this.openRouterModels = Object.entries(data.data).map(([id, model]) => ({
            id,
            name: model.name,
            category: model.category
          }));
          console.log(`Loaded ${this.openRouterModels.length} OpenRouter models`);
          this.populateOpenRouterModels();
        }
      }
    } catch (error) {
      console.warn('Could not load OpenRouter models:', error);
      // Graceful degradation - app still works with core models
    } finally {
      this.isLoading = false;
    }
  }
  
  populateOpenRouterModels() {
    const container = document.getElementById('openrouter-models-container');
    if (!container) return;
    
    // Clear existing
    container.innerHTML = '';
    
    // Add OpenRouter models
    this.openRouterModels.forEach(model => {
      const button = document.createElement('button');
      button.id = `openrouter-${model.id.replace(/[^a-zA-Z0-9]/g, '-')}`;
      button.className = 'openrouter-model';
      button.setAttribute('data-value', model.id);
      button.textContent = model.name;
      
      // Add click handler using the original selectModel function
      button.addEventListener('click', () => {
        if (typeof selectModel === 'function') {
          selectModel(model.id);
        }
      });
      
      container.appendChild(button);
    });
  }
  
  setupEventHandlers() {
    // OpenRouter toggle
    const openRouterToggle = document.getElementById('show-open-router');
    if (openRouterToggle) {
      openRouterToggle.addEventListener('change', (e) => {
        const container = document.getElementById('openrouter-models-container');
        const openRouterModels = document.querySelectorAll('.openrouter-model');
        
        if (e.target.checked) {
          if (container) container.style.display = 'block';
          openRouterModels.forEach(model => model.style.display = 'block');
        } else {
          if (container) container.style.display = 'none';
          openRouterModels.forEach(model => model.style.display = 'none');
        }
      });
    }
    
    // Model search
    const searchInput = document.getElementById('model-search');
    if (searchInput) {
      searchInput.addEventListener('input', (e) => {
        this.filterModels(e.target.value);
      });
    }
  }
  
  filterModels(searchTerm) {
    const allModelButtons = document.querySelectorAll('#model-options button');
    const lowerSearch = searchTerm.toLowerCase();
    
    allModelButtons.forEach(button => {
      const text = button.textContent.toLowerCase();
      const shouldShow = text.includes(lowerSearch);
      button.style.display = shouldShow ? 'block' : 'none';
    });
  }
}

// Initialize enhanced model manager after DOM loads
document.addEventListener('DOMContentLoaded', function() {
  // Wait a bit for the original script to initialize
  setTimeout(() => {
    window.enhancedModelManager = new EnhancedModelManager();
  }, 1000);
});

// Keep original functionality intact
// The original script.js handles all the core functionality
// This just enhances it with dynamic OpenRouter models
</script>
</body>
</html>